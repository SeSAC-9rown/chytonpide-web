<% content_for :styles do %>
    <%= stylesheet_link_tag "reset" %>
    <%= stylesheet_link_tag "variables" %>
    <%= stylesheet_link_tag "typography" %>
    <%= stylesheet_link_tag "mypage" %>
    <%= stylesheet_link_tag "mobile" %>
<% end %>

<div class="mypage">
    <!-- Header -->
    <header class="mypage-header">
        <h1 class="page-title">마이페이지</h1>
        <a href="#" class="settings-btn">
            <%= image_tag "common/icons/settings.svg", alt: "설정" %>
        </a>
    </header>

    <!-- Main Content -->
    <div class="mypage-content">
        <!-- Profile Section -->
        <section class="profile-section">
            <div class="profile-badge">
                <span class="level-text">Level 3</span>
                <span class="level-name">치피러버</span>
            </div>

            <div class="profile-image-container">
                <%= image_tag "chipi/chipi-sprout.png", alt: "치피", class: "profile-image" %>
            </div>

            <div class="profile-info">
                <div class="nickname-container">
                    <h2 class="nickname">차차피피</h2>
                    <a href="#" class="edit-btn">
                        <%= image_tag "common/icons/edit.svg", alt: "수정" %>
                    </a>
                </div>
                <p class="email">user@google.com</p>
            </div>

            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-label">식물 수</div>
                    <div class="stat-value">5</div>
                </div>
                <div class="stat-divider"></div>
                <div class="stat-item">
                    <div class="stat-label">성장일지 수</div>
                    <div class="stat-value">52</div>
                </div>
            </div>
        </section>

        <!-- Recipe Section -->
        <section class="recipe-section">
            <h3 class="section-title">바질 활용 레시피</h3>

            <div class="recipe-carousel">
                <div class="recipe-track">
                    <div class="recipe-card">
                        <%= image_tag "mypage/recipe-pasta.jpg", alt: "바질 파스타", class: "recipe-image" %>
                        <p class="recipe-name">바질 파스타</p>
                    </div>
                    <div class="recipe-card">
                        <%= image_tag "mypage/recipe-caprese.jpg", alt: "카프레제", class: "recipe-image" %>
                        <p class="recipe-name">카프레제</p>
                    </div>
                    <div class="recipe-card">
                        <%= image_tag "mypage/recipe-toast.jpg", alt: "바질 토스트", class: "recipe-image" %>
                        <p class="recipe-name">바질 토스트</p>
                    </div>
                    <div class="recipe-card">
                        <%= image_tag "mypage/recipe-salad.jpg", alt: "바질 샐러드", class: "recipe-image" %>
                        <p class="recipe-name">바질 샐러드</p>
                    </div>
                </div>
            </div>

            <!-- Carousel Indicators -->
            <div class="carousel-indicators">
                <span class="indicator active"></span>
                <span class="indicator"></span>
                <span class="indicator"></span>
                <span class="indicator"></span>
            </div>
        </section>

        <!-- Ad Banner Section -->
        <section class="ad-section">
            <div class="ad-banner">
                <%= image_tag "mypage/ad-product.png", alt: "광고 배너", class: "ad-image" %>
            </div>
        </section>

        <!-- Logout Section -->
        <section class="action-section">
            <%= button_to "로그아웃", 
                          logout_path, 
                          method: :delete,
                          form: { class: "action-form" },
                          class: "action-btn logout-btn" %>
        </section>

        <!-- Delete Account Section -->
        <section class="action-section">
            <button 
              id="delete-account-btn"
              class="action-btn delete-btn">
              회원 탈퇴
            </button>
        </section>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="<%= log_path %>" class="nav-item">
            <%= image_tag "common/icons/nav-diary.svg", class: "nav-icon", alt: "성장일지" %>
            <div class="nav-label">성장일지</div>
        </a>
        <a href="<%= root_path %>" class="nav-item">
            <%= image_tag "common/icons/nav-home.svg", class: "nav-icon", alt: "홈" %>
            <div class="nav-label">홈</div>
        </a>
        <a href="<%= mypage_path %>" class="nav-item active">
            <%= image_tag "common/icons/nav-mypage.svg", class: "nav-icon", alt: "마이페이지" %>
            <div class="nav-label">마이페이지</div>
        </a>
    </nav>
</div>

<script>
  document.getElementById('delete-account-btn').addEventListener('click', () => {
    const confirmed = confirm('정말 탈퇴하시겠습니까?\n모든 데이터가 삭제되며 복구되지 않습니다.');
    
    if (confirmed) {
      fetch('<%= user_path(current_user) %>', {
        method: 'DELETE',
        headers: {
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
          'Content-Type': 'application/json'
        }
      })
      .then(response => {
        if (response.ok) {
          alert('회원 탈퇴가 완료되었습니다.');
          window.location.href = '<%= root_path %>';
        } else {
          alert('탈퇴 중 오류가 발생했습니다.');
        }
      })
      .catch(error => {
        console.error('오류:', error);
        alert('탈퇴 중 오류가 발생했습니다.');
      });
    }
  });
</script>
