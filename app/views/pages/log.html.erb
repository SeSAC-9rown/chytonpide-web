<% content_for :styles do %>
    <%= stylesheet_link_tag "reset" %>
    <%= stylesheet_link_tag "variables" %>
    <%= stylesheet_link_tag "typography" %>
    <%= stylesheet_link_tag "log" %>
    <%= stylesheet_link_tag "mobile" %>
<% end %>

<div class="diary">
    <!-- Background Image -->
    <%= image_tag "home/day-background.png", alt: "낮 배경", class: "log-background" %>
    
    <!-- Date Navigation Header -->
    <header class="diary-header">
        <%= link_to log_path(date: @prev_date), class: "nav-arrow" do %>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        <% end %>

        <div class="date-display">
            <input type="checkbox" id="calendar-toggle" class="calendar-checkbox">
            <label for="calendar-toggle" class="date-button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="calendar-icon">
                    <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                    <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span class="date-text"><%= @date.strftime("%Y. %m. %d") %></span>
            </label>

            <!-- Calendar Popup -->
            <div class="calendar-popup">
                <h3 class="calendar-title">
                    <%= @date.strftime("%Y년 %m월") %>
                </h3>

                <div class="calendar-grid">
                    <div class="calendar-weekdays">
                        <% %w[일 월 화 수 목 금 토].each do |w| %>
                            <div class="weekday"><%= w %></div>
                        <% end %>
                    </div>

                    <div class="calendar-days">
                        <% @start_wday.times do %>
                            <div class="day"></div>
                        <% end %>
                        <% (1..@days_in_month).each do |d| %>
                            <div class="day"><%= d %></div>
                        <% end %>
                    </div>
                </div>
            </div>
        </div>

        <% if @is_future %>
            <span class="nav-arrow nav-arrow-disabled">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </span>
        <% else %>
            <%= link_to log_path(date: @next_date), class: "nav-arrow" do %>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            <% end %>
        <% end %>
    </header>

    <!-- 캐릭터: 메인 카드 밖, fixed 대상 -->
    <div class="chipi-floating">
        <%= image_tag "chipi/chipi-day.png", alt: "치피 캐릭터", class: "chipi-character" %>
    </div>

    <!-- Main Content (고정 하단 컨테이너) -->
    <div class="diary-main">
        <div class="diary-scroll">
            <main class="diary-content">
                <section class="diary-card diary-card-hero">
                    <h1 class="diary-title">오늘의 치피</h1>
                </section>

                <% if @log.present? %>
                    <!-- 일지가 있을 때 -->
                    
                    <!-- Plant Image -->
                    <section class="diary-card">
                        <div class="plant-image-container">
                            <% if @log.image.attached? %>
                                <%= image_tag @log.image, alt: "치피 사진", class: "plant-image" %>
                            <% else %>
                                <%= image_tag "diary/plant-basil-new.svg", alt: "치피 사진", class: "plant-image" %>
                            <% end %>
                        </div>
                    </section>

                    <!-- Growth Status Cards -->
                    <section class="diary-card">
                        <div class="status-cards">
                            <!-- Growth Stage Card -->
                            <div class="status-card stage-card">
                                <div class="card-header">
                                    <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="card-icon">
                                        <g clip-path="url(#clip0_196_2199)">
                                            <path d="M7.3334 13.3335C6.16277 13.337 5.03357 12.9005 4.16975 12.1104C3.30592 11.3204 2.77058 10.2345 2.66989 9.06824C2.5692 7.90194 2.91053 6.7404 3.62617 5.81399C4.34181 4.88758 5.37949 4.26396 6.5334 4.06683C10.3334 3.3335 11.3334 2.98683 12.6667 1.3335C13.3334 2.66683 14.0001 4.12016 14.0001 6.66683C14.0001 10.3335 10.8134 13.3335 7.3334 13.3335Z" stroke="#7cb342" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M1.33337 14C1.33337 12 2.56671 10.4267 4.72004 10C6.33337 9.68 8.00004 8.66667 8.66671 8" stroke="#7cb342" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_196_2199">
                                                <rect width="16" height="16" fill="white"/>
                                            </clipPath>
                                        </defs>
                                    </svg>
                                    <h3 class="card-title">성장 단계</h3>
                                </div>
                                <div class="stage-display">
                                    <div class="stage-number">
                                        <%= case @log.growth_stage
                                            when 'Sprout' then '1단계'
                                            when 'Middle' then '2단계'
                                            when 'Adult' then '3단계'
                                            else '1단계'
                                        end %>
                                    </div>
                                    <div class="stage-progress">
                                        <div class="progress-dash <%= @log.growth_stage == 'Sprout' || @log.growth_stage == 'Middle' || @log.growth_stage == 'Adult' ? 'active' : '' %>"></div>
                                        <div class="progress-dash <%= @log.growth_stage == 'Middle' || @log.growth_stage == 'Adult' ? 'active' : '' %>"></div>
                                        <div class="progress-dash <%= @log.growth_stage == 'Adult' ? 'active' : '' %>"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Growth Speed Card -->
                            <div class="status-card speed-card">
                                <div class="card-header">
                                    <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="card-icon">
                                        <path d="M10.6666 4.6665H14.6666V8.6665" stroke="#7cb342" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M14.6667 4.6665L9.00004 10.3332L5.66671 6.99984L1.33337 11.3332" stroke="#7cb342" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <h3 class="card-title">성장 속도</h3>
                                </div>
                                <div class="speed-info">
                                    <p class="speed-result">2일전 마지막<br>치피 모습 대비<br>10% 자랐어요</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Health Alert -->
                    <section class="diary-card">
                        <div class="health-alert <%= @log.is_healthy ? 'healthy' : 'warning' %>">
                            <div class="alert-header">
                                <div class="alert-icon">
                                    <% if @log.is_healthy %>
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                            ircle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                            <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    <% else %>
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                            ircle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                                            <line x1="12" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                            ircle cx="12" cy="16" r="1" fill="currentColor" />
                                        </svg>
                                    <% end %>
                                </div>
                                <h4 class="alert-title">
                                    <%= @log.is_healthy ? '치피가 건강해요!' : '잎에서 병해충이 의심됩니다' %>
                                </h4>
                            </div>
                            <div class="alert-content">
                                <p class="alert-description">
                                    <%= if @log.is_healthy
                                        '치피가 건강하게 잘 자라고 있어요. 지금처럼 계속 관리해주세요!'
                                    else
                                        '잎에 갈색 반점이 보여요. 병든 잎은 바로 떼어내고, 주의 너무 습하지 않게 관리해주세요. 햇빛이 잘 들고 통풍이 좋은 곳에 두세요.'
                                    end %>
                                </p>
                            </div>
                        </div>
                    </section>

                    <!-- Content -->
                    <% if @log.content.present? %>
                        <section class="diary-card">
                            <div class="info-card">
                                <h2 class="info-title">성장 기록</h2>
                                <p class="info-description">
                                    <%= @log.content %>
                                </p>
                            </div>
                        </section>
                    <% end %>

                <% else %>
                    <!-- 일지가 없을 때 -->
                    <section class="diary-card">
                        <div class="info-card">
                            <h2 class="info-title">치피 사진을 등록해주세요!</h2>
                            <p class="info-description">
                                오늘의 사진을 올리면<br>치피의 건강을 확인해줄게요!
                            </p>
                        </div>
                    </section>

                    <section class="diary-card">
                        <div class="action-buttons">
                            <%= link_to new_user_log_path(current_user, date: @date), class: "action-btn primary-btn" do %>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="btn-icon">
                                    <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                                    ircle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/>
                                    <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                사진 등록하기
                            <% end %>

                            <%= link_to new_user_log_path(current_user, date: @date), class: "action-btn secondary-btn" do %>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="btn-icon">
                                    <rect x="2" y="2" width="20" height="20" rx="2" stroke="currentColor" stroke-width="2"/>
                                    <rect x="6" y="6" width="5" height="5" rx="1" stroke="currentColor" stroke-width="2"/>
                                    <rect x="13" y="6" width="5" height="5" rx="1" stroke="currentColor" stroke-width="2"/>
                                    <rect x="6" y="13" width="5" height="5" rx="1" stroke="currentColor" stroke-width="2"/>
                                    <rect x="13" y="13" width="5" height="5" rx="1" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                사진 보관함에서 가져오기
                            <% end %>
                        </div>
                    </section>
                <% end %>
            </main>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <%= link_to log_path, class: "nav-item active" do %>
            <%= image_tag "common/icons/nav-diary.svg", alt: "성장일지", class: "nav-icon" %>
            <div class="nav-label">성장일지</div>
        <% end %>
        <%= link_to root_path, class: "nav-item" do %>
            <%= image_tag "common/icons/nav-home.svg", alt: "홈", class: "nav-icon" %>
            <div class="nav-label">홈</div>
        <% end %>
        <%= link_to mypage_path, class: "nav-item" do %>
            <%= image_tag "common/icons/nav-mypage.svg", alt: "마이페이지", class: "nav-icon" %>
            <div class="nav-label">마이페이지</div>
        <% end %>
    </nav>
</div>
